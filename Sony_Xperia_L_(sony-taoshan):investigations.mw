Presently, the kernel from Lineage OS can be compiled, but it does not boot...


== Kernel compilation ==

The kernel used comes from Lineage OS. 

The ''android_device_sony_taoshan'' github repository contains a file named ''lineage.dependencies'' witch indicates the name of the kernel used : ''android_kernel_sony_msm8930''.

* [https://github.com/LineageOS/android_device_sony_taoshan XPeria L Github repository]
* [https://github.com/LineageOS/android_kernel_sony_msm8930 kernel Github repository]
* [https://raw.githubusercontent.com/LineageOS/android_kernel_sony_msm8930/cm-14.1/arch/arm/configs/taoshan_defconfig Taoshan kernel configuration file on msm8930 Github repository]

The patch [[https://github.com/postmarketOS/pmbootstrap/blob/master/aports/device/linux-lg-mako/02_gpu-msm-fix-gcc5-compile.patch  gpu-msm-fix-gcc5-compile.patch]] is necessary to fix the following error : ''undefined reference to kgsl_iommu_sync_lock''.


To resolve a ''xz not found'' error, the ''xz'' utility was added in the ''makedepends'' directive of the ''APKBUILD'' file : 

<pre>
  makedepends="perl sed installkernel bash gmp-dev bc linux-headers elfutils-dev devicepkg-dev xz" 
</pre>

== Packing boot.img ==

Is seems like boot.img may not be exactly regular boot.img as unpacking tools for working ones says these files were packed with non-standard mkbootimg, way to test would be to find a way to unpack existing boot.img, repack it again with proper tools/options until it boots, then try the same tools with pmos kernel and/or initramfs
{{note| The tool I use may be wrong one but it worked with Samsung ones (samsung-s6500d)}}
<source lang="bash">
Boot = boot.img
unmkbootimg version 1.2 - Mikael Q Kuisma <kuisma@ping.se>
Kernel size 5847800
Kernel address 0x80208000
Ramdisk size 7421021
Ramdisk address 0x82200000
Secondary size 0
Secondary address 0x81100000
Kernel tags address 0x80200100
Flash page size 2048
Board name is ""
Command line "console=ttyHSL0,115200,n8 androidboot.hardware=qcom androidboot.bootdevice=msm_sdcc.1 user_debug=31 msm_rtb.filter=0x3F ehci-hcd.park=3 maxcpus=2 buildvariant=userdebug"

*** WARNING ****
This image is built using NON-standard mkbootimg!
OFF_RAMDISK_ADDR is 0x02000000
Please modify mkbootimg.c using the above values to build your image.
****************

Extracting kernel to file zImage ...
Extracting root filesystem to file initramfs.cpio.gz ...
All done.
---------------
To recompile this image, use:
  mkbootimg --kernel zImage --ramdisk initramfs.cpio.gz --base 0x80200000 --cmdline 'console=ttyHSL0,115200,n8 androidboot.hardware=qcom androidboot.bootdevice=msm_sdcc.1 user_debug=31 msm_rtb.filter=0x3F ehci-hcd.park=3 maxcpus=2 buildvariant=userdebug' -o new_boot.img
---------------
24525 blocks
</source>

== Motherboard ==

[[File:Taoshan_motherboard_sa77GA341.JPG|thumb|left|SA77_GA-341 motherboard]]

The reference of the motherboard is ''''sa77_GA-341''''

Presently, we have no idea where the UART pins (TX, RX and ground) are located. Maybe at the top left, under the 'D' letter...
